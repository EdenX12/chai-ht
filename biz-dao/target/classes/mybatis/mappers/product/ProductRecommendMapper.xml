<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tian.sakura.cdd.db.dao.product.ProductRecommendMapper">
  <resultMap id="BaseResultMap" type="com.tian.sakura.cdd.db.domain.product.ProductRecommend">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" jdbcType="VARCHAR" property="id" />
    <result column="product_id" jdbcType="VARCHAR" property="productId" />
    <result column="product_type_id" jdbcType="VARCHAR" property="productTypeId" />
    <result column="recommend_type_id" jdbcType="VARCHAR" property="recommendTypeId" />
    <result column="is_on_face" jdbcType="INTEGER" property="isOnFace" />
    <result column="s_order" jdbcType="INTEGER" property="sOrder" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
    <result column="create_user" jdbcType="INTEGER" property="createUser" />
    <result column="update_user" jdbcType="INTEGER" property="updateUser" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, product_id, product_type_id, recommend_type_id, is_on_face, s_order, create_time,
    update_time, create_user, update_user
  </sql>



  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select
    <include refid="Base_Column_List" />
    from s_product_recommend
    where id = #{id,jdbcType=VARCHAR}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from s_product_recommend
    where id = #{id,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="com.tian.sakura.cdd.db.domain.product.ProductRecommend">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into s_product_recommend (id, product_id, product_type_id,
      recommend_type_id, is_on_face, s_order,
      create_time, update_time, create_user,
      update_user)
    values (#{id,jdbcType=VARCHAR}, #{productId,jdbcType=VARCHAR}, #{productTypeId,jdbcType=VARCHAR},
      #{recommendTypeId,jdbcType=VARCHAR}, #{isOnFace,jdbcType=INTEGER}, #{sOrder,jdbcType=INTEGER},
      #{createTime,jdbcType=TIMESTAMP}, #{updateTime,jdbcType=TIMESTAMP}, #{createUser,jdbcType=INTEGER},
      #{updateUser,jdbcType=INTEGER})
  </insert>
  <insert id="insertSelective" parameterType="com.tian.sakura.cdd.db.domain.product.ProductRecommend">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into s_product_recommend
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="productId != null">
        product_id,
      </if>
      <if test="productTypeId != null">
        product_type_id,
      </if>
      <if test="recommendTypeId != null">
        recommend_type_id,
      </if>
      <if test="isOnFace != null">
        is_on_face,
      </if>
      <if test="sOrder != null">
        s_order,
      </if>
      <if test="createTime != null">
        create_time,
      </if>
      <if test="updateTime != null">
        update_time,
      </if>
      <if test="createUser != null">
        create_user,
      </if>
      <if test="updateUser != null">
        update_user,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=VARCHAR},
      </if>
      <if test="productId != null">
        #{productId,jdbcType=VARCHAR},
      </if>
      <if test="productTypeId != null">
        #{productTypeId,jdbcType=VARCHAR},
      </if>
      <if test="recommendTypeId != null">
        #{recommendTypeId,jdbcType=VARCHAR},
      </if>
      <if test="isOnFace != null">
        #{isOnFace,jdbcType=INTEGER},
      </if>
      <if test="sOrder != null">
        #{sOrder,jdbcType=INTEGER},
      </if>
      <if test="createTime != null">
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateTime != null">
        #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="createUser != null">
        #{createUser,jdbcType=INTEGER},
      </if>
      <if test="updateUser != null">
        #{updateUser,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.tian.sakura.cdd.db.domain.product.ProductRecommend">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update s_product_recommend
    <set>
      <if test="productId != null">
        product_id = #{productId,jdbcType=VARCHAR},
      </if>
      <if test="productTypeId != null">
        product_type_id = #{productTypeId,jdbcType=VARCHAR},
      </if>
      <if test="recommendTypeId != null">
        recommend_type_id = #{recommendTypeId,jdbcType=VARCHAR},
      </if>
      <if test="isOnFace != null">
        is_on_face = #{isOnFace,jdbcType=INTEGER},
      </if>
      <if test="sOrder != null">
        s_order = #{sOrder,jdbcType=INTEGER},
      </if>
      <if test="createTime != null">
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateTime != null">
        update_time = #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="createUser != null">
        create_user = #{createUser,jdbcType=INTEGER},
      </if>
      <if test="updateUser != null">
        update_user = #{updateUser,jdbcType=INTEGER},
      </if>
    </set>
    where id = #{id,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.tian.sakura.cdd.db.domain.product.ProductRecommend">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update s_product_recommend
    set product_id = #{productId,jdbcType=VARCHAR},
      product_type_id = #{productTypeId,jdbcType=VARCHAR},
      recommend_type_id = #{recommendTypeId,jdbcType=VARCHAR},
      is_on_face = #{isOnFace,jdbcType=INTEGER},
      s_order = #{sOrder,jdbcType=INTEGER},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      update_time = #{updateTime,jdbcType=TIMESTAMP},
      create_user = #{createUser,jdbcType=INTEGER},
      update_user = #{updateUser,jdbcType=INTEGER}
    where id = #{id,jdbcType=VARCHAR}
  </update>


    <resultMap id="RecommendPrdMap" type="com.tian.sakura.cdd.db.domain.base.RecommendType">
      <id column="id" jdbcType="VARCHAR" property="id" />
      <result column="recommend_title" jdbcType="VARCHAR" property="recommendTitle" />
      <result column="page_style" jdbcType="INTEGER" property="pageStyle" />
      <collection property="productList" ofType="com.tian.sakura.cdd.db.domain.product.Product">
        <id column="product_id" jdbcType="INTEGER" property="id"/>
        <result column="type_id" jdbcType="INTEGER" property="typeId"/>
        <result column="product_name" jdbcType="VARCHAR" property="productName"/>
        <result column="product_img" jdbcType="VARCHAR" property="productImg"/>
        <result column="product_des" jdbcType="VARCHAR" property="productDes"/>
        <result column="task_number" jdbcType="INTEGER" property="taskNumber"/>
        <result column="product_price" jdbcType="DECIMAL" property="productPrice"/>
        <result column="total_reward" jdbcType="DECIMAL" property="totalReward"/>
        <result column="task_price" jdbcType="DECIMAL" property="taskPrice"/>
        <result column="price_unit" jdbcType="VARCHAR" property="priceUnit"/>
        <result column="product_type" jdbcType="INTEGER" property="productType"/>
      </collection>
    </resultMap>

   <select id="selectRecommendPrd" resultMap="RecommendPrdMap"
           parameterType="com.tian.sakura.cdd.db.manage.product.vo.ProductRecommendQueryVo">
        select
           c.id , c.page_style, c.recommend_title ,
           a.id product_id, a.type_id, a.product_name, a.product_img, a.product_des,
           a.task_number, a.product_price, a.total_reward, a.task_price
        from s_recommend_type c
        left join s_product_recommend b on c.id = b.recommend_type_id
        left join s_product a on b.product_id = a.id and product_status = 1
        where
            1=1
           <if test="recommendTypeId != null and recommendTypeId != ''">
             AND c.id = #{recommendTypeId}
           </if>
            <if test="productTypeId != null and productTypeId != ''">
              AND a.type_id = #{productTypeId}
            </if>
          and c.recommend_status = 1
          order by c.s_order, A.id

   </select>
  <select id="listRecommend" resultType="com.tian.sakura.cdd.common.resp.product.RecommendProductResp">
    SELECT
        a.*, b.product_img AS productImg,
        b.product_name AS productName,
        c.recommend_title as recommendTypeName
    FROM
        `s_product_recommend` a
    LEFT JOIN s_product b ON a.product_id = b.id
    LEFT JOIN s_recommend_type c on a.recommend_type_id = c.id
    where 1=1
    <if test="productName != null and productName != ''">
        and b.product_name like concat('%', #{productName}, '%')
    </if>
    <if test="recommendTypeId != null and recommendTypeId != ''">
        and a.recommend_type_id = #{recommendTypeId}
    </if>
  </select>
  <select id="selectCountByProductId" resultType="java.lang.Integer">
    select count(*) from s_product_recommend where product_id = #{productId}
    and recommend_type_id = #{recommendTypeId}
  </select>
</mapper>