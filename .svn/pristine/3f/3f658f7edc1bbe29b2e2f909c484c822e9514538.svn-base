<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tian.sakura.cdd.db.dao.order.OrderDetailMapper">
  <resultMap id="BaseResultMap" type="com.tian.sakura.cdd.db.domain.order.OrderDetail">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" jdbcType="VARCHAR" property="id" />
    <result column="order_id" jdbcType="VARCHAR" property="orderId" />
    <result column="shop_id" jdbcType="VARCHAR" property="shopId" />
    <result column="user_id" jdbcType="VARCHAR" property="userId" />
    <result column="order_sn" jdbcType="VARCHAR" property="orderSn" />
    <result column="payment_type" jdbcType="INTEGER" property="paymentType" />
    <result column="payment_state" jdbcType="INTEGER" property="paymentState" />
    <result column="payment_time" jdbcType="TIMESTAMP" property="paymentTime" />
    <result column="order_amount" jdbcType="DECIMAL" property="orderAmount" />
    <result column="shipping_fee" jdbcType="DECIMAL" property="shippingFee" />
    <result column="coupon_amount" jdbcType="DECIMAL" property="couponAmount" />
    <result column="user_coupon_id" jdbcType="VARCHAR" property="userCouponId" />
    <result column="pay_amount" jdbcType="DECIMAL" property="payAmount" />
    <result column="shipping_express_code" jdbcType="VARCHAR" property="shippingExpressCode" />
    <result column="shipping_express_id" jdbcType="INTEGER" property="shippingExpressId" />
    <result column="shipping_code" jdbcType="VARCHAR" property="shippingCode" />
    <result column="shipping_time" jdbcType="TIMESTAMP" property="shippingTime" />
    <result column="address_id" jdbcType="VARCHAR" property="addressId" />
    <result column="order_message" jdbcType="VARCHAR" property="orderMessage" />
    <result column="order_status" jdbcType="INTEGER" property="orderStatus" />
    <result column="address_name" jdbcType="VARCHAR" property="addressName" />
    <result column="address_phone" jdbcType="VARCHAR" property="addressPhone" />
    <result column="address_detail" jdbcType="VARCHAR" property="addressDetail" />
    <result column="channel" jdbcType="INTEGER" property="channel" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="cancel_reason" jdbcType="VARCHAR" property="cancelReason" />
    <result column="pickup_flag" jdbcType="INTEGER" property="pickupFlag" />

  </resultMap>
  <resultMap extends="BaseResultMap" id="ResultMapWithBLOBs" type="com.tian.sakura.cdd.db.domain.order.OrderDetail">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <result column="deliver_explain" jdbcType="LONGVARCHAR" property="deliverExplain" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, order_id, shop_id, user_id, order_sn, payment_type, payment_state, payment_time,
    order_amount, shipping_fee, coupon_amount, user_coupon_id, pay_amount, shipping_express_code,
    shipping_express_id, shipping_code, shipping_time, address_id, order_message, order_status,
    address_name, address_phone, address_detail, channel, create_time,cancel_reason,pickup_flag
  </sql>
  <sql id="Blob_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    deliver_explain
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="ResultMapWithBLOBs">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select
    <include refid="Base_Column_List" />
    ,
    <include refid="Blob_Column_List" />
    from s_order_detail
    where id = #{id,jdbcType=VARCHAR}
  </select>

  <select id="selectByOrderId" parameterType="string" resultMap="BaseResultMap">
    SELECT
        a.*, b.shop_name AS shopName
    FROM
        s_order_detail a
    LEFT JOIN s_shop b ON a.shop_id = b.id
    where order_id = #{orderId,jdbcType=VARCHAR}
  </select>

  <resultMap id="BaseResultMapWithProduct" type="com.tian.sakura.cdd.db.domain.order.OrderDetail">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" jdbcType="VARCHAR" property="id" />
    <result column="order_id" jdbcType="VARCHAR" property="orderId" />
    <result column="shop_id" jdbcType="INTEGER" property="shopId" />
    <result column="shop_name" jdbcType="VARCHAR" property="shopName" />
    <result column="user_id" jdbcType="VARCHAR" property="userId" />
    <result column="nick_name" jdbcType="VARCHAR" property="nickName" />
    <result column="user_img" jdbcType="VARCHAR" property="userImg" />
    <result column="order_sn" jdbcType="VARCHAR" property="orderSn" />
    <result column="payment_type" jdbcType="INTEGER" property="paymentType" />
    <result column="payment_state" jdbcType="INTEGER" property="paymentState" />
    <result column="payment_time" jdbcType="TIMESTAMP" property="paymentTime" />
    <result column="order_amount" jdbcType="DECIMAL" property="orderAmount" />
    <result column="pay_amount" jdbcType="DECIMAL" property="payAmount" />
    <result column="order_status" jdbcType="INTEGER" property="orderStatus" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="address_name" jdbcType="VARCHAR" property="addressName" />
    <result column="address_phone" jdbcType="VARCHAR" property="addressPhone" />
    <result column="address_detail" jdbcType="VARCHAR" property="addressDetail" />
    <collection property="orderProductList" ofType="com.tian.sakura.cdd.db.domain.order.OrderProduct">
      <id column="order_product_id" jdbcType="VARCHAR" property="id" />
      <result column="order_detail_id" jdbcType="VARCHAR" property="orderDetailId" />
      <result column="product_id" jdbcType="VARCHAR" property="productId" />
      <result column="product_spec_value_name" jdbcType="VARCHAR" property="productSpecValueName" />
      <result column="product_number" jdbcType="INTEGER" property="productNumber" />
      <result column="product_price" jdbcType="DECIMAL" property="productPrice" />
      <result column="product_name" jdbcType="VARCHAR" property="productName" />
      <result column="product_img" jdbcType="VARCHAR" property="productImg" />
      <result column="delivery_type" jdbcType="INTEGER" property="deliveryType" />
    </collection>
  </resultMap>
  <select id="selectByQueryVo" parameterType="com.tian.sakura.cdd.db.manage.order.vo.OrderDetailQueryVo"
          resultMap="BaseResultMapWithProduct">
      select
         a.id,
         a.order_id,
         a.shop_id,
         c.shop_name,
         a.pay_amount,
         a.user_id,
         d.nick_name,
         a.order_sn,
         a.order_amount,
         a.create_time,
         a.order_status,
         a.payment_state,
         a.payment_time,
         b.id order_product_id,
         b.product_id,
         b.product_spec_value_name,
         b.product_number,
         b.product_name,
         b.product_img,
         b.product_price,
         a.address_name,
         a.address_phone,
         a.address_detail,
         d.user_img,
         b.delivery_type
      from s_order_detail a ,
           s_order_product b,
           s_shop c,
           s_user d
      where a.id = order_detail_id
          and a.shop_id = c.id
          and a.user_id = d.id
      <if test="userId != null and userId != ''">
         and a.user_id =  #{userId,jdbcType=VARCHAR}
      </if>
      <if test="shopId != null ">
       and a.shop_id =  #{shopId,jdbcType=INTEGER}
      </if>
      <if test="orderStatus != null ">
        and a.order_status =  #{orderStatus,jdbcType=INTEGER}
      </if>
      <if test="orderStatusList != null and orderStatusList != ''">
          and a.order_status in  ${orderStatusList}
      </if>

      <if test="deliveryType != null">
          and b.delivery_type =  #{deliveryType,jdbcType=INTEGER}
      </if>
    <if test="startDate != null" >
      and a.create_time <![CDATA[ >= ]]> #{startDate, jdbcType=TIMESTAMP}
    </if>
    <if test="endDate != null" >
      and a.create_time <![CDATA[ <= ]]> #{endDate, jdbcType=TIMESTAMP}
    </if>
    <if test="keyWord != null and keyWord !='' ">
      and( order_sn like concat('%', #{keyWord}, '%')  or 
          address_Name like concat('%', #{keyWord}, '%') or
          address_phone like concat('%', #{keyWord}, '%')
      )
    </if>    
     order by a.order_id ,a.shop_id, b.product_id
  </select>


  <select id="selectUnPayByQueryVo" parameterType="com.tian.sakura.cdd.db.manage.order.vo.OrderDetailQueryVo"
          resultMap="BaseResultMapWithProduct">
    select
    a.id,
    a.order_id,
    a.shop_id,
    c.shop_name,
    a.pay_amount,
    a.user_id,
    d.nick_name,
    a.order_sn,
    a.order_amount,
    a.create_time,
    a.order_status,
    b.id order_product_id,
    b.product_id,
    b.product_spec_value_name,
    b.product_number,
    b.product_name,
    b.product_img,
    b.product_price,
    a.address_name,
    a.address_phone,
    a.address_detail,
    d.user_img,
    b.delivery_type
    from s_order_detail a ,
    s_order_product b,
    s_shop c,
    s_user d
    where a.id = order_detail_id
    and a.shop_id = c.id
    and a.user_id = d.id
    <if test="userId != null and userId != ''">
      and a.user_id =  #{userId,jdbcType=VARCHAR}
    </if>
    <if test="shopId != null ">
      and a.shop_id =  #{shopId,jdbcType=INTEGER}
    </if>
    <if test="orderStatus != null ">
      and a.order_status =  #{orderStatus,jdbcType=INTEGER}
    </if>
    <if test="orderStatusList != null and orderStatusList != ''">
      and a.order_status in  ${orderStatusList}
    </if>

    <if test="deliveryType != null">
      and b.delivery_type =  #{deliveryType,jdbcType=INTEGER}
    </if>
    <if test="startDate != null" >
      and a.create_time <![CDATA[ >= ]]> #{startDate, jdbcType=TIMESTAMP}
    </if>
    <if test="endDate != null" >
      and a.create_time <![CDATA[ <= ]]> #{endDate, jdbcType=TIMESTAMP}
    </if>
    order by a.order_id ,a.shop_id, b.product_id
  </select>

  <resultMap id="CntOfOrderStatusResultMap" type="com.tian.sakura.cdd.common.entity.KeyValuePair">
    <id column="order_status" jdbcType="VARCHAR" property="name" />
    <result column="cnt" jdbcType="VARCHAR" property="value" />
  </resultMap>
  <select id="selectCntOfOrderStatusByUserId" resultMap="CntOfOrderStatusResultMap">
     select count(1) cnt , order_status
     from s_order_detail
     where user_id =  #{userId,jdbcType=VARCHAR}
     group by order_status
  </select>
  <select id="listOrderDetail" resultType="com.tian.sakura.cdd.db.domain.order.OrderDetail">
    SELECT
        a.*, b.shop_name AS shopName,
        c.nick_name AS nickName
    FROM
        s_order_detail a
    LEFT JOIN s_shop b ON a.shop_id = b.id
    LEFT JOIN s_user c ON a.user_id = c.id
    where 1=1
    <if test="shopName != null and shopName != ''">
      and b.shop_name = #{shopName}
    </if>
    <if test="orderStatus != null">
      and a.order_status = #{orderStatus}
    </if>
    <if test="orderSn != null and orderSn != null">
      and a.order_sn = #{orderSn}
    </if>
    <if test="addressName != null and addressName != ''">
      and a.address_name like concat('%', #{addressName}, '%')
    </if>
    <if test="nickName != null and nickName != ''">
      and c.nick_name like concat('%', #{nickName}, '%')
    </if>
    <if test="shopId != null and shopId != ''">
      and a.shop_id = #{shopId}
    </if>
    order by a.create_time desc
  </select>
  <select id="queryNotShipped" parameterType="com.tian.sakura.cdd.db.manage.order.vo.OrderDetailQueryVo"
          resultMap="BaseResultMapWithProduct">
      SELECT
          a.id,
          a.order_id,
          a.shop_id,
          a.pay_amount,
          a.user_id,
          a.order_sn,
          a.order_amount,
          a.create_time,
          a.payment_time,
          a.order_status,
          b.id order_product_id,
          b.product_id,
          b.product_spec_value_name,
          b.product_number,
          b.product_name,
          b.product_img,
          b.product_price,
          a.address_name,
          a.address_phone,
          a.address_detail,
          c.shop_name
      FROM
          s_order_detail a,
          s_order_product b,
	      s_shop c
      WHERE
          a.id = b.order_detail_id
          AND a.shop_id = c.id
          AND a.order_status = '1'
          <if test="shopId != null and shopId != ''">
            AND a.shop_id = #{shopId}
          </if>
      order by a.payment_time desc
  </select>

  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from s_order_detail
    where id = #{id,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="com.tian.sakura.cdd.db.domain.order.OrderDetail">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into s_order_detail (id, order_id, shop_id,
      user_id, order_sn, payment_type,
      payment_state, payment_time, order_amount,
      shipping_fee, coupon_amount, user_coupon_id,
      pay_amount, shipping_express_code, shipping_express_id,
      shipping_code, shipping_time, address_id,
      order_message, order_status, address_name,
      address_phone, address_detail, channel,
      create_time, deliver_explain,pickup_flag)
    values (#{id,jdbcType=VARCHAR}, #{orderId,jdbcType=VARCHAR}, #{shopId,jdbcType=VARCHAR},
      #{userId,jdbcType=VARCHAR}, #{orderSn,jdbcType=VARCHAR}, #{paymentType,jdbcType=INTEGER},
      #{paymentState,jdbcType=INTEGER}, #{paymentTime,jdbcType=TIMESTAMP}, #{orderAmount,jdbcType=DECIMAL},
      #{shippingFee,jdbcType=DECIMAL}, #{couponAmount,jdbcType=DECIMAL}, #{userCouponId,jdbcType=VARCHAR},
      #{payAmount,jdbcType=DECIMAL}, #{shippingExpressCode,jdbcType=VARCHAR}, #{shippingExpressId,jdbcType=INTEGER},
      #{shippingCode,jdbcType=VARCHAR}, #{shippingTime,jdbcType=TIMESTAMP}, #{addressId,jdbcType=VARCHAR},
      #{orderMessage,jdbcType=VARCHAR}, #{orderStatus,jdbcType=INTEGER}, #{addressName,jdbcType=VARCHAR},
      #{addressPhone,jdbcType=VARCHAR}, #{addressDetail,jdbcType=VARCHAR}, #{channel,jdbcType=INTEGER},
      #{createTime,jdbcType=TIMESTAMP}, #{deliverExplain,jdbcType=LONGVARCHAR},
      #{pickupFlag,jdbcType=INTEGER})
  </insert>
  <insert id="insertSelective" parameterType="com.tian.sakura.cdd.db.domain.order.OrderDetail">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into s_order_detail
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="orderId != null">
        order_id,
      </if>
      <if test="shopId != null">
        shop_id,
      </if>
      <if test="userId != null">
        user_id,
      </if>
      <if test="orderSn != null">
        order_sn,
      </if>
      <if test="paymentType != null">
        payment_type,
      </if>
      <if test="paymentState != null">
        payment_state,
      </if>
      <if test="paymentTime != null">
        payment_time,
      </if>
      <if test="orderAmount != null">
        order_amount,
      </if>
      <if test="shippingFee != null">
        shipping_fee,
      </if>
      <if test="couponAmount != null">
        coupon_amount,
      </if>
      <if test="userCouponId != null">
        user_coupon_id,
      </if>
      <if test="payAmount != null">
        pay_amount,
      </if>
      <if test="shippingExpressCode != null">
        shipping_express_code,
      </if>
      <if test="shippingExpressId != null">
        shipping_express_id,
      </if>
      <if test="shippingCode != null">
        shipping_code,
      </if>
      <if test="shippingTime != null">
        shipping_time,
      </if>
      <if test="addressId != null">
        address_id,
      </if>
      <if test="orderMessage != null">
        order_message,
      </if>
      <if test="orderStatus != null">
        order_status,
      </if>
      <if test="addressName != null">
        address_name,
      </if>
      <if test="addressPhone != null">
        address_phone,
      </if>
      <if test="addressDetail != null">
        address_detail,
      </if>
      <if test="channel != null">
        channel,
      </if>
      <if test="createTime != null">
        create_time,
      </if>
      <if test="deliverExplain != null">
        deliver_explain,
      </if>
      <if test="pickupFlag != null">
        pickup_flag,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=VARCHAR},
      </if>
      <if test="orderId != null">
        #{orderId,jdbcType=VARCHAR},
      </if>
      <if test="shopId != null">
        #{shopId,jdbcType=VARCHAR},
      </if>
      <if test="userId != null">
        #{userId,jdbcType=VARCHAR},
      </if>
      <if test="orderSn != null">
        #{orderSn,jdbcType=VARCHAR},
      </if>
      <if test="paymentType != null">
        #{paymentType,jdbcType=INTEGER},
      </if>
      <if test="paymentState != null">
        #{paymentState,jdbcType=INTEGER},
      </if>
      <if test="paymentTime != null">
        #{paymentTime,jdbcType=TIMESTAMP},
      </if>
      <if test="orderAmount != null">
        #{orderAmount,jdbcType=DECIMAL},
      </if>
      <if test="shippingFee != null">
        #{shippingFee,jdbcType=DECIMAL},
      </if>
      <if test="couponAmount != null">
        #{couponAmount,jdbcType=DECIMAL},
      </if>
      <if test="userCouponId != null">
        #{userCouponId,jdbcType=VARCHAR},
      </if>
      <if test="payAmount != null">
        #{payAmount,jdbcType=DECIMAL},
      </if>
      <if test="shippingExpressCode != null">
        #{shippingExpressCode,jdbcType=VARCHAR},
      </if>
      <if test="shippingExpressId != null">
        #{shippingExpressId,jdbcType=INTEGER},
      </if>
      <if test="shippingCode != null">
        #{shippingCode,jdbcType=VARCHAR},
      </if>
      <if test="shippingTime != null">
        #{shippingTime,jdbcType=TIMESTAMP},
      </if>
      <if test="addressId != null">
        #{addressId,jdbcType=VARCHAR},
      </if>
      <if test="orderMessage != null">
        #{orderMessage,jdbcType=VARCHAR},
      </if>
      <if test="orderStatus != null">
        #{orderStatus,jdbcType=INTEGER},
      </if>
      <if test="addressName != null">
        #{addressName,jdbcType=VARCHAR},
      </if>
      <if test="addressPhone != null">
        #{addressPhone,jdbcType=VARCHAR},
      </if>
      <if test="addressDetail != null">
        #{addressDetail,jdbcType=VARCHAR},
      </if>
      <if test="channel != null">
        #{channel,jdbcType=INTEGER},
      </if>
      <if test="createTime != null">
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="deliverExplain != null">
        #{deliverExplain,jdbcType=LONGVARCHAR},
      </if>
      <if test="pickupFlag != null">
        #{pickupFlag,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.tian.sakura.cdd.db.domain.order.OrderDetail">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update s_order_detail
    <set>
      <if test="orderId != null">
        order_id = #{orderId,jdbcType=VARCHAR},
      </if>
      <if test="shopId != null">
        shop_id = #{shopId,jdbcType=VARCHAR},
      </if>
      <if test="userId != null">
        user_id = #{userId,jdbcType=VARCHAR},
      </if>
      <if test="orderSn != null">
        order_sn = #{orderSn,jdbcType=VARCHAR},
      </if>
      <if test="paymentType != null">
        payment_type = #{paymentType,jdbcType=INTEGER},
      </if>
      <if test="paymentState != null">
        payment_state = #{paymentState,jdbcType=INTEGER},
      </if>
      <if test="paymentTime != null">
        payment_time = #{paymentTime,jdbcType=TIMESTAMP},
      </if>
      <if test="orderAmount != null">
        order_amount = #{orderAmount,jdbcType=DECIMAL},
      </if>
      <if test="shippingFee != null">
        shipping_fee = #{shippingFee,jdbcType=DECIMAL},
      </if>
      <if test="couponAmount != null">
        coupon_amount = #{couponAmount,jdbcType=DECIMAL},
      </if>
      <if test="userCouponId != null">
        user_coupon_id = #{userCouponId,jdbcType=VARCHAR},
      </if>
      <if test="payAmount != null">
        pay_amount = #{payAmount,jdbcType=DECIMAL},
      </if>
      <if test="shippingExpressCode != null">
        shipping_express_code = #{shippingExpressCode,jdbcType=VARCHAR},
      </if>
      <if test="shippingExpressId != null">
        shipping_express_id = #{shippingExpressId,jdbcType=INTEGER},
      </if>
      <if test="shippingCode != null">
        shipping_code = #{shippingCode,jdbcType=VARCHAR},
      </if>
      <if test="shippingTime != null">
        shipping_time = #{shippingTime,jdbcType=TIMESTAMP},
      </if>
      <if test="addressId != null">
        address_id = #{addressId,jdbcType=VARCHAR},
      </if>
      <if test="orderMessage != null">
        order_message = #{orderMessage,jdbcType=VARCHAR},
      </if>
      <if test="orderStatus != null">
        order_status = #{orderStatus,jdbcType=INTEGER},
      </if>
      <if test="addressName != null">
        address_name = #{addressName,jdbcType=VARCHAR},
      </if>
      <if test="addressPhone != null">
        address_phone = #{addressPhone,jdbcType=VARCHAR},
      </if>
      <if test="addressDetail != null">
        address_detail = #{addressDetail,jdbcType=VARCHAR},
      </if>
      <if test="channel != null">
        channel = #{channel,jdbcType=INTEGER},
      </if>
      <if test="createTime != null">
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="deliverExplain != null">
        deliver_explain = #{deliverExplain,jdbcType=LONGVARCHAR},
      </if>
      <if test="cancelReason != null">
        cancel_reason = #{cancelReason,jdbcType=LONGVARCHAR},
      </if>
      <if test="pickupFlag != null">
        pickup_flag = #{pickupFlag,jdbcType=INTEGER},
      </if>
    </set>
    where id = #{id,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKeyWithBLOBs" parameterType="com.tian.sakura.cdd.db.domain.order.OrderDetail">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update s_order_detail
    set order_id = #{orderId,jdbcType=VARCHAR},
      shop_id = #{shopId,jdbcType=VARCHAR},
      user_id = #{userId,jdbcType=VARCHAR},
      order_sn = #{orderSn,jdbcType=VARCHAR},
      payment_type = #{paymentType,jdbcType=INTEGER},
      payment_state = #{paymentState,jdbcType=INTEGER},
      payment_time = #{paymentTime,jdbcType=TIMESTAMP},
      order_amount = #{orderAmount,jdbcType=DECIMAL},
      shipping_fee = #{shippingFee,jdbcType=DECIMAL},
      coupon_amount = #{couponAmount,jdbcType=DECIMAL},
      user_coupon_id = #{userCouponId,jdbcType=VARCHAR},
      pay_amount = #{payAmount,jdbcType=DECIMAL},
      shipping_express_code = #{shippingExpressCode,jdbcType=VARCHAR},
      shipping_express_id = #{shippingExpressId,jdbcType=INTEGER},
      shipping_code = #{shippingCode,jdbcType=VARCHAR},
      shipping_time = #{shippingTime,jdbcType=TIMESTAMP},
      address_id = #{addressId,jdbcType=VARCHAR},
      order_message = #{orderMessage,jdbcType=VARCHAR},
      order_status = #{orderStatus,jdbcType=INTEGER},
      address_name = #{addressName,jdbcType=VARCHAR},
      address_phone = #{addressPhone,jdbcType=VARCHAR},
      address_detail = #{addressDetail,jdbcType=VARCHAR},
      channel = #{channel,jdbcType=INTEGER},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      deliver_explain = #{deliverExplain,jdbcType=LONGVARCHAR},
      pickup_flag = #{pickupFlag,jdbcType=INTEGER}
    where id = #{id,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.tian.sakura.cdd.db.domain.order.OrderDetail">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update s_order_detail
    set order_id = #{orderId,jdbcType=VARCHAR},
      shop_id = #{shopId,jdbcType=VARCHAR},
      user_id = #{userId,jdbcType=VARCHAR},
      order_sn = #{orderSn,jdbcType=VARCHAR},
      payment_type = #{paymentType,jdbcType=INTEGER},
      payment_state = #{paymentState,jdbcType=INTEGER},
      payment_time = #{paymentTime,jdbcType=TIMESTAMP},
      order_amount = #{orderAmount,jdbcType=DECIMAL},
      shipping_fee = #{shippingFee,jdbcType=DECIMAL},
      coupon_amount = #{couponAmount,jdbcType=DECIMAL},
      user_coupon_id = #{userCouponId,jdbcType=VARCHAR},
      pay_amount = #{payAmount,jdbcType=DECIMAL},
      shipping_express_code = #{shippingExpressCode,jdbcType=VARCHAR},
      shipping_express_id = #{shippingExpressId,jdbcType=INTEGER},
      shipping_code = #{shippingCode,jdbcType=VARCHAR},
      shipping_time = #{shippingTime,jdbcType=TIMESTAMP},
      address_id = #{addressId,jdbcType=VARCHAR},
      order_message = #{orderMessage,jdbcType=VARCHAR},
      order_status = #{orderStatus,jdbcType=INTEGER},
      address_name = #{addressName,jdbcType=VARCHAR},
      address_phone = #{addressPhone,jdbcType=VARCHAR},
      address_detail = #{addressDetail,jdbcType=VARCHAR},
      channel = #{channel,jdbcType=INTEGER},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      pickup_flag = #{pickupFlag,jdbcType=INTEGER}
    where id = #{id,jdbcType=VARCHAR}
  </update>

   <update id="updateOrderDetailByOrderId" parameterType="com.tian.sakura.cdd.db.domain.order.OrderDetail">
        update s_order_detail
        set
        payment_type = #{paymentType,jdbcType=INTEGER},
        payment_state = #{paymentState,jdbcType=INTEGER},
        payment_time = #{paymentTime,jdbcType=TIMESTAMP},
        order_status = #{orderStatus,jdbcType=INTEGER}
        where order_id = #{orderId,jdbcType=VARCHAR}
   </update>
  <update id="updateShippingCode">
    update s_order_detail set shipping_code = #{shippingCode} where id = #{id}
  </update>

  <!--  已付款  -->
   <select id="hasPaidOrderCnt" resultType="java.util.HashMap">
       select count(*) as cnt,sum(order_amount) as orderAmount,sum(pay_amount) as payAmount
       from s_order_detail
       where shop_id = #{shopId}
            and create_time <![CDATA[ >= ]]> #{startDate, jdbcType=TIMESTAMP}
	      	and create_time <![CDATA[ <= ]]> #{endDate, jdbcType=TIMESTAMP}
   </select>

	<!--  根据状态统计  -->
   <select id="statOrderCnt" resultType="java.util.HashMap">
       select count(*) as cnt,sum(order_amount) as orderAmount,sum(pay_amount) as payAmount
       from s_order_detail
       where shop_id = #{shopId}
       		<if test="orderStatus != null">
       			and order_status = #{orderStatus}
       		</if>
       		<if test="startDate != null">
            	and create_time <![CDATA[ >= ]]> #{startDate, jdbcType=TIMESTAMP}
            </if>
            <if test="endDate != null">
	      		and create_time <![CDATA[ <= ]]> #{endDate, jdbcType=TIMESTAMP}
	      	</if>
   </select>
	<!--  拆单统计  -->
   <select id="taskOrderCnt" resultType="java.util.HashMap">
   	select count(a.id) cnt
	from s_product a,
    	 s_user_task_line b,
     	s_task_line c
	where a.shop_id= #{shopId}
    	 and a.id = b.product_id
     	and b.pay_status = '1'
     	and b.task_line_id = c.id
     	and c.line_status in (0,1)
        and b.create_time <![CDATA[ >= ]]> #{startDate, jdbcType=TIMESTAMP}
     	and b.create_time <![CDATA[ <= ]]> #{endDate, jdbcType=TIMESTAMP}
	</select>   

	<!--  今日新增客户数统计  -->
   <select id="statCustCnt" resultType="java.util.HashMap">
       select count(distinct user_id) as cnt
       from s_order_detail
       where shop_id = #{shopId}
       		<if test="startDate != null">
            	and create_time <![CDATA[ >= ]]> #{startDate, jdbcType=TIMESTAMP}
            </if>
            <if test="endDate != null">
	      		and create_time <![CDATA[ <= ]]> #{endDate, jdbcType=TIMESTAMP}
	      	</if>
   </select>
   
   <!--  重复购买的客户数  -->
   <select  id = "repeatCustCnt" resultType="java.util.HashMap">
		select count(1) as cnt
		from
		(
			select user_id, count(1)
			from s_order_detail 
			where shop_id = #{shopId}
				group by  user_id
				having count(1) > 1
		) as a
   </select>
   
   <!--  商品销量  -->
   <select  id = "getSellQuantityByPrdId" resultType="java.util.HashMap">
		select sum(a.product_number) as cnt
		from s_order_product a,
   			 s_order_detail b
		where a.order_detail_id = b.id
      		and a.product_id = #{productId}
      		and b.payment_state = 1
   </select>
   
	<!--  根据状态统计  -->
   <select id="statOrderCntByStatus" resultType="java.util.HashMap">
       select count(*) as cnt,sum(order_amount) as orderAmount,sum(pay_amount) as payAmount,
              order_status orderStatus
       from s_order_detail
       where shop_id = #{shopId}
       		<if test="startDate != null">
            	and create_time <![CDATA[ >= ]]> #{startDate, jdbcType=TIMESTAMP}
            </if>
            <if test="endDate != null">
	      		and create_time <![CDATA[ <= ]]> #{endDate, jdbcType=TIMESTAMP}
	      	</if>
	      	group by order_status
   </select>

   <!--  商铺销量  -->
   <select  id = "getSellQuantityByShopId" resultType="java.util.HashMap">
		select sum(a.product_number) as cnt
		from s_order_product a,
   			 s_order_detail b
		where a.order_detail_id = b.id
      		and b.shop_id = #{shopId}
      		and b.payment_state = 1
      		and b.order_status in (1,2,3)
   </select>
    <select id="orderDetailShippingCode" resultType="com.tian.sakura.cdd.db.domain.order.OrderDetail">
      select * from s_order_detail where order_status >= '2'
    </select>

</mapper>